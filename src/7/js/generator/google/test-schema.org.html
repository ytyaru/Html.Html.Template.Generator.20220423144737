<!--<script src="../../../lib/extensible-custom-error/0.0.7/full.js"></script>-->
<script src="../../../lib/extensible-custom-error/0.0.7/min.js"></script>
<script src="../../../lib/prettier/2.6.2/standalone.js"></script>
<script src="../../../lib/prettier/2.6.2/parser-babel.js"></script>
<script src="schema.org.js"></script>
<script>
class UnitTestError extends ExtensibleCustomError {}
/*
class UnitTestError extends Error {
    constructor(message) {
        super(message);
        this.name = this.constructor.name;
        // V8のとき必要
        if (Error.captureStackTrace) { Error.captureStackTrace(this, this.constructor); }
        // ES5やそれ以前のとき必要
        Object.setPrototypeOf(this, new.target.prototype);
    }
}
*/
// 出力されたJSON-LDは以下URLのリッチリザルトでバリデートする
// https://search.google.com/test/rich-results?hl=ja
// <script type="application/ld+json"><\/script> で囲う必要がある。
class TestSchemaOrg { // Googleが対応しているものだけ
    #makeTag(jsonLdStr) { return `<script type="application/ld+json">${this.#prettier(jsonLdStr)}<\/script>`; }
    #prettier(jsonLdStr) { return prettier.format(jsonLdStr, {
        parser: 'json',
        plugins: prettierPlugins,
    })}
    testBreadcrumbList() { // OK! 警告もなし。だがプレビューできなかった。
        const data = new Map()
        data.set('🏠', 'https://example.com/index.html')
        data.set('階層1', 'https://example.com/category1/index.html')
        data.set('階層2', '')
        const jsonLd = SchemaOrg.BreadcrumbList(data).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testFaqPage() { // OK! プレビューもできたが上から順に2件しか表示されなかった。
        const data = new Map()
        data.set('これはよくある質問ですか？', 'はい、そうです。')
        data.set('これはどんな形式のデータで作られましたか？', 'JSON-LD形式です。schema.orgのうちGoogleの定義に従ったプロパティを使用しました。')
        data.set('これはバリデートチェックしましたか？', 'はい。<a href="https://search.google.com/test/rich-results?hl=ja">リッチリザルト</a>で正しい書式であることを確認しました。')
        const jsonLd = SchemaOrg.FaqPage(data).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testSimpleQuiz() { // OKだが警告あり（任意項目18件未入力）
        const title = 'クイズです'
        const question = 'パンはパンでも食べられないパンは？'
        const answer = 'フライパン'
        const suggests = ['しまパン', 'チンギスパン']
        const jsonLd = SchemaOrg.SimpleQuiz(title, question, answer, suggests).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testSimpleQuizWithComment() { // OKだが警告あり（任意項目15件未入力）
        const title = 'クイズです'
        const question = 'パンはパンでも食べられないパンは？'
        const answer = ['フライパン', '固くて食べられないよ！']
        const suggests = [['しまパン', 'その筋の人なら食べられます。'], ['チンギスパン', '有名な食べ物です。知らないんですか？']]
        const jsonLd = SchemaOrg.SimpleQuiz(title, question, answer, suggests).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testSimpleQuizes() { // OKだが警告あり（任意項目35件未入力）
        const title = 'クイズです'
        const questions = []
        questions.push({
            question: 'パンはパンでも食べられないパンは？',
            answer: 'フライパン',
            suggests: ['しまパン', 'チンギスパン'],
        })
        questions.push({
            question: '１＋１は？',
            answer: '田',
            suggests: ['２', '３'],
        }) 
        const jsonLd = SchemaOrg.SimpleQuizes(title, questions).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testSimpleQuizesWithComment() { // OKだが警告あり（任意項目29件未入力）
        const title = 'クイズです'
        const questions = []
        questions.push({
            question: 'パンはパンでも食べられないパンは？',
            answer: ['フライパン', '固くて食べられないよ！'],
            suggests: [['しまパン', 'その筋の人なら食べられます。'], ['チンギスパン', '有名な食べ物です。知らないんですか？']],
        })
        questions.push({
            question: '１＋１は？',
            answer: ['田', '1+1に=の線をそれぞれ上下に配置すると田になる。'],
            suggests: [['２', '算数としては正解ですがクイズとしては不正解です。'], ['３', 'クイズとしても算数としても不正解です。']],
        }) 
        const jsonLd = SchemaOrg.SimpleQuizes(title, questions).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testHowTo1Minimum() { // OKだが警告あり（任意項目29件未入力）
        const jsonLd = SchemaOrg.HowTo('ラズパイの起動方法', ['ACアダプタをコンセントに挿す。']).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testHowTo1MultiStep() { // OKでプレビュー確認できたが警告あり（任意項目12件未入力）
        const jsonLd = SchemaOrg.HowTo('ラズパイの起動方法', ['ACアダプタをコンセントに挿す。', '電源スイッチを入れる。', 'ブート完了を待つ。']).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testHowTo1Options() { // OKでプレビュー確認できたがオプション項目が表示されなかった。警告あり（任意項目12件未入力）
        const jsonLd = SchemaOrg.HowTo('ラズパイの起動方法', 
            ['ACアダプタをコンセントに挿す。', '電源スイッチを入れる。', 'ブート完了を待つ。'],
            {
                image: 'https://a.png',
                totalTime: 'P2D3H4M5S',
                estimatedCost: SchemaOrg.MonetaryAmount(123),
            }
        ).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testMonetaryAmountMinimum() {
        const money = SchemaOrg.MonetaryAmount(123)
        console.assert(money['@type'] === 'MonetaryAmount')
        console.assert(money.value === 123)
        console.assert(money.currency === 'JPY')
    }
    testMonetaryAmountUSD() {
        const money = SchemaOrg.MonetaryAmount(234.5, 'USD')
        console.assert(money['@type'] === 'MonetaryAmount')
        console.assert(money.value === 234.5)
        console.assert(money.currency === 'USD')
    }
    testHowToToolError() {
        try { SchemaOrg.HowToTool({}); }
        catch (e) {
            if (!(e instanceof SchemaOrgParameterError)) { throw new UnitTestError(`エラーの型はSchemaOrgParameterErrorであるべきです。: ${e.constructor.name}`); }
            if ('HowToToolの引数optionにはnameキーと値が必須です。' !== e.message) { throw new UnitTestError(`エラーメッセージは「HowToToolの引数optionにはnameキーと値が必須です。」であるべきです。: ${e.message}`); }
        }
    }
    testHowToSupplyError() {
        try { SchemaOrg.HowToSupply({}); }
        catch (e) {
            if (!(e instanceof SchemaOrgParameterError)) { throw new UnitTestError(`エラーの型はSchemaOrgParameterErrorであるべきです。: ${e.constructor.name}`); }
            if ('HowToSupplyの引数optionにはnameキーと値が必須です。' !== e.message) { throw new UnitTestError(`エラーメッセージは「HowToSupplyの引数optionにはnameキーと値が必須です。」であるべきです。: ${e.message}`); }
        }
    }
    testHowToToolMinimum() {
        const expected = 'ドライバー（＋）'
        const tool = SchemaOrg.HowToTool({name: expected});
        console.assert(expected === tool.name)
    }
    testHowToToolWithImage() {
        const name = 'ドライバー（＋）'
        const image = 'https://a.png'
        const tool = SchemaOrg.HowToTool({name: name, image: image});
        console.assert(name === tool.name)
        console.assert(image === tool.image)
    }
    testHowToSupplyMinimum() {
        const expected = 'ドライバー（＋）'
        const supply = SchemaOrg.HowToSupply({name: expected});
        console.assert(expected === supply.name)
    }
    testHowToSupplyWithImage() {
        const name = 'ドライバー（＋）'
        const image = 'https://a.png'
        const supply = SchemaOrg.HowToSupply({name: name, image: image});
        console.assert(name === supply.name)
        console.assert(image === supply.image)
    }
    /*
    testHowTo1OptionsSupplyTool() { // OKでプレビュー確認できたがオプション項目が表示されなかった。警告あり（任意項目12件未入力）
        const jsonLd = SchemaOrg.HowTo('ラズパイの起動方法', 
            ['ACアダプタをコンセントに挿す。', '電源スイッチを入れる。', 'ブート完了を待つ。'],
            {
                image: 'https://a.png',
                totalTime: 'P2D3H4M5S',
                estimatedCost: SchemaOrg.MonetaryAmount(123),
                supply: HowToSupplies
                tool: 
            }
        ).generate()
        console.log(this.#makeTag(jsonLd))
    }
    testHowTo2Minimum() { // OKだが警告あり（任意項目29件未入力）
        const jsonLd = SchemaOrg.HowTo('ラズパイの起動方法', ['ACアダプタをコンセントに挿す。']).generate()
        console.log(this.#makeTag(jsonLd))
    }
    */
}
const test = new TestSchemaOrg() 
test.testBreadcrumbList()
test.testFaqPage()
test.testSimpleQuiz()
test.testSimpleQuizWithComment()
test.testSimpleQuizes()
test.testSimpleQuizesWithComment()
test.testHowTo1Minimum()
test.testHowTo1MultiStep()
test.testHowTo1Options()
test.testMonetaryAmountMinimum()
test.testMonetaryAmountUSD()
test.testHowToToolError()
test.testHowToSupplyError()
test.testHowToToolMinimum()
test.testHowToToolWithImage()
test.testHowToSupplyMinimum()
test.testHowToSupplyWithImage()
</script>
</script>
